{% extends 'base.html' %}
{% load widget_tweaks %}
{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3>{{ user.username }}</h3>
            </div>
            <div class="card-body">
                {% if user.profile.profile_pic %}
                <img src="{{ user.profile.profile_pic.url }}" class="img-fluid rounded-circle mb-3" style="max-width: 150px;">
                {% else %}
                <div class="rounded-circle d-flex align-items-center justify-content-center mb-3" 
                   style="width: 150px; height: 150px; max-width: 150px; background-color: #6c757d; color: white; font-size: 3rem; ">
                   {{ user.username|first|upper }}
               </div>
                {% endif %}
                <p>{{ user.profile.bio }}</p>
               <!-- <p>Email: {{ user.email }}</p>--> 
                
               

                
                
            </div>
                <div class="card-footer">
                    <button class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#profileModal" style="margin-right: 90px;">Edit Profile</button>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#profileModal2">
                    <i class="bi bi-gear-fill"></i> Settings
                  </button>

               </div>
        </div>
    </div>
    
    
</div>
  <h1>Your Posts</h1>
<div class="row">
  
    {% for post in user_posts %}
    <div class="col-md-4"> 
        <div class="card mb-3">
            
            <div class="card-header d-flex justify-content-between align-items-center">
                 {{ post.title }} 
                <div>
                    <small>{{ post.created_at|date:"F d, Y" }}</small>
                    {% if user.profile.private_account %}
                        <i class="bi bi-lock-fill text-secondary ms-2" title="Only visible to you"></i>
                    {% endif %}
                </div>
            </div>
            <div class="card-body">
                {% if post.post_type == 'image' %}
                <img src="{{ post.file.url }}" class="img-fluid"  alt="{{ post.title }}">
                {% elif post.post_type == 'video' %}
                <video controls class="img-fluid" >
                    <source src="{{ post.file.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                {% endif %}
                <p class="mt-2">{{ post.description }}</p>
            </div>
            <div class="card-footer ">
                <a href="{% url 'download_file' post.id %}" class="btn btn-sm btn-primary " style="margin-right: 160px;">Download</a>
                <a href="{% url 'delete_post' post.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this post?')">Delete</a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="alert alert-info">You haven't created any posts yet.</div>
    {% endfor %}
</div>




<!-- Profile Edit Modal -->
<div class="modal fade" id="profileModal"  >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               
            </div>
            
            
            <div class="modal-body">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="{{ form.bio.id_for_label }}" class="form-label">Bio</label>
                      {{ form.bio|add_class:"form-control" }}
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.profile_pic.id_for_label }}" class="form-label">Profile Picture</label>
                         {{ form.profile_pic|add_class:"form-control" }}
                        
                    </div>
                 <div class="modal-footer  justify-content-center" action="{% url 'profile' %}">
                     <button type="submit" class="btn btn-primary">Save Changes</button>
                 </div>
               
                    
                </form>
                

            </div>
           
             
        </div>
    </div>
</div>

<div class="modal fade" id="profileModal2" >
    <div class="modal-dialog">
      <div class="modal-content">
      
        <div class="modal-header">
          <h5 class="modal-title" id="profileModal2Label">User Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <div class="modal-body" >
          <p><strong>Username:</strong> {{ user.username }}</p>
          <p><strong>Email:</strong> {{ user.email }}</p> 
          <div class="form-check form-switch mb-3 ">
            <form method="POST" action="{% url 'toggle_privacy' %}">
                {% csrf_token %}
                <input class="form-check-input" type="checkbox" id="privateAccountToggle" 
                       {% if user.profile.private_account %}checked{% endif %}
                       onchange="this.form.submit()">
                <label class="form-check-label" for="privateAccountToggle">
                    <i class="bi {% if user.profile.private_account %}bi-lock-fill{% else %}bi-unlock-fill{% endif %}"></i>
                    {% if user.profile.private_account %}Private Account{% else %}Public Account{% endif %}
                </label>
            </form>
        </div>
            <div class="modal-footer  "  >
                <form method="POST" action="{% url 'delete_account' %}" onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger me-5">Delete Account</button>
                    <button type="button" class="btn btn-primary  " data-bs-dismiss="modal">Close</button>
                </form>

            </div>
        
        
       

       
        

       <!-- <div class="modal-footer">
            <button type="button" class="btn btn-primary  " data-bs-dismiss="modal">Close</button>
        </div>-->

        
      
      </div>
    </div>
  </div>





  
{% endblock %}